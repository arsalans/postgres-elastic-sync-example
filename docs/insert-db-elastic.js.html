<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: insert-db-elastic.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: insert-db-elastic.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
let loopback = require('loopback');
const helpers_1 = require("../../utils/helpers");
const decorated_queue_object_1 = require("../queue/decorated-queue-object");
const messageProducer = require("../queue/message-producer");
let logger = require("../../logger");
/**
 * This method inserts the json content both in postgres and elastic search (through queue). It should be called like this:
 * &lt;pre>
 *    http://localhost:3000/api/Articles/sync/insert/article/100ABCD
 *    The article needs to be posted as follows:
 *    {
 *      "id": "100ABCD",
 *      "version": "4",
 *      "blob": {"city": "Mississauga", "name": "Arsalan"}
 *    }
 * &lt;pre>
 * @param id defines the object id (i.e., article id)
 * @param article defines the data in the body of the request as explained above.
 * @param index defines the elastic search index where the data will be inserted (i.e., article)
 * @returns {boolean} true if everything is successful
 */
function insertIntoDatabaseAndElastic(id, article, index) {
    helpers_1.validateIsUndefinedOrNull(id, "id");
    helpers_1.validateIsUndefinedOrNull(article, "article");
    helpers_1.validateIsUndefinedOrNull(index, "index");
    let app = loopback();
    let articleModel = app.registry.getModel('Article');
    articleModel.create(article)
        .then(insertIntoElasticSearchThroughQueue(id, article, index))
        .catch(function (error) {
        logger.error("Error saving into database, will NOT insert into elastic search.", error);
    });
    return false;
}
exports.insertIntoDatabaseAndElastic = insertIntoDatabaseAndElastic;
function insertIntoElasticSearchThroughQueue(objectId, article, index) {
    let decoratedQueueObject = new decorated_queue_object_1.DecoratedQueueObject(objectId, article, index, "insert");
    messageProducer.sendMessageToDefaultQueue(JSON.stringify(decoratedQueueObject));
}
//# sourceMappingURL=insert-db-elastic.js.map</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#deleteFromDatabaseAndElastic">deleteFromDatabaseAndElastic</a></li><li><a href="global.html#insertIntoDatabaseAndElastic">insertIntoDatabaseAndElastic</a></li><li><a href="global.html#updateIntoDatabaseAndElastic">updateIntoDatabaseAndElastic</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Jan 06 2017 14:55:08 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
